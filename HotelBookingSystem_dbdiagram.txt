// 飯店訂房系統資料庫設計 - dbdiagram.io 版本

// 1. 飯店資訊表
Table Hotel {
  HotelID int [pk, increment]
  Name varchar(100) [not null]
  Address varchar(255) [not null]
  City varchar(50) [not null]
  Country varchar(50) [not null]
  PostalCode varchar(20)
  Phone varchar(20) [not null]
  Email varchar(100)
  Website varchar(100)
  Description text
  StarRating decimal(2,1)
  CheckinTime time [not null, default: '15:00']
  CheckoutTime time [not null, default: '12:00']
  IsActive boolean [not null, default: true]
  CreatedDate datetime [not null, default: `now()`]
  UpdatedDate datetime
}

// 2. 飯店設施表
Table HotelAmenity {
  AmenityID int [pk, increment]
  Name varchar(100) [not null]
  Description varchar(255)
  Icon varchar(50)
}

// 3. 飯店與設施關聯表
Table HotelHasAmenity {
  HotelID int [not null]
  AmenityID int [not null]
  
  Indexes {
    (HotelID, AmenityID) [pk]
  }
}

// 4. 飯店圖片表
Table HotelImage {
  ImageID int [pk, increment]
  HotelID int [not null]
  ImageURL varchar(255) [not null]
  Caption varchar(100)
  IsPrimary boolean [not null, default: false]
  DisplayOrder int [not null, default: 0]
}

// 5. 房型表
Table RoomType {
  RoomTypeID int [pk, increment]
  HotelID int [not null]
  Name varchar(100) [not null]
  Description text
  BasePrice decimal(10,2) [not null]
  BaseCurrency varchar(3) [not null, default: 'TWD']
  MaxOccupancy int [not null]
  BedConfiguration varchar(100)
  RoomSize varchar(50)
  IsActive boolean [not null, default: true]
}

// 6. 房型設施表
Table RoomAmenity {
  AmenityID int [pk, increment]
  Name varchar(100) [not null]
  Description varchar(255)
  Icon varchar(50)
}

// 7. 房型與設施關聯表
Table RoomTypeHasAmenity {
  RoomTypeID int [not null]
  AmenityID int [not null]
  
  Indexes {
    (RoomTypeID, AmenityID) [pk]
  }
}

// 8. 房型圖片表
Table RoomTypeImage {
  ImageID int [pk, increment]
  RoomTypeID int [not null]
  ImageURL varchar(255) [not null]
  Caption varchar(100)
  IsPrimary boolean [not null, default: false]
  DisplayOrder int [not null, default: 0]
}

// 9. 客房表
Table Room {
  RoomID int [pk, increment]
  HotelID int [not null]
  RoomTypeID int [not null]
  RoomNumber varchar(20) [not null]
  Floor varchar(10)
  Status varchar(20) [not null, default: 'Available']
  Notes varchar(255)
  IsActive boolean [not null, default: true]
  
  Indexes {
    (HotelID, RoomNumber) [unique]
  }
}

// 10. 用戶表
Table User {
  UserID int [pk, increment]
  Email varchar(100) [not null, unique]
  PasswordHash varchar(255) [not null]
  FirstName varchar(50) [not null]
  LastName varchar(50) [not null]
  Phone varchar(20)
  Address varchar(255)
  City varchar(50)
  Country varchar(50)
  PostalCode varchar(20)
  DateOfBirth date
  Gender varchar(10)
  Nationality varchar(50)
  PassportNumber varchar(50)
  UserType varchar(20) [not null, default: 'Customer']
  RegistrationDate datetime [not null, default: `now()`]
  LastLoginDate datetime
  IsVerified boolean [not null, default: false]
  IsActive boolean [not null, default: true]
}

// 11. 價格方案表
Table PricePlan {
  PricePlanID int [pk, increment]
  RoomTypeID int [not null]
  Name varchar(100) [not null]
  Description varchar(255)
  ValidFrom date [not null]
  ValidTo date [not null]
  DayOfWeekBitmask int [not null, default: 127]
  Price decimal(10,2) [not null]
  Currency varchar(3) [not null, default: 'TWD']
  IsBreakfastIncluded boolean [not null, default: false]
  IsRefundable boolean [not null, default: true]
  RefundPercentage decimal(5,2)
  MinStayLength int
  MaxStayLength int
  AdvanceBookingDays int
  IsActive boolean [not null, default: true]
}

// 12. 促銷活動表
Table Promotion {
  PromotionID int [pk, increment]
  Name varchar(100) [not null]
  Description text
  DiscountType varchar(20) [not null]
  DiscountValue decimal(10,2) [not null]
  ValidFrom datetime [not null]
  ValidTo datetime [not null]
  PromotionCode varchar(20)
  MinimumStay int
  MinimumAmount decimal(10,2)
  ApplicableRoomTypes varchar(255)
  ApplicableHotels varchar(255)
  MaxUsageCount int
  CurrentUsageCount int [not null, default: 0]
  IsActive boolean [not null, default: true]
}

// 13. 預訂表
Table Booking {
  BookingID int [pk, increment]
  BookingReference varchar(20) [not null, unique]
  UserID int [not null]
  BookingDate datetime [not null, default: `now()`]
  CheckInDate date [not null]
  CheckOutDate date [not null]
  AdultCount int [not null]
  ChildCount int [not null, default: 0]
  SpecialRequests text
  TotalAmount decimal(10,2) [not null]
  DiscountAmount decimal(10,2) [not null, default: 0]
  TaxAmount decimal(10,2) [not null, default: 0]
  FinalAmount decimal(10,2) [not null]
  Currency varchar(3) [not null, default: 'TWD']
  BookingStatus varchar(20) [not null, default: 'Confirmed']
  PromotionID int
  PaymentStatus varchar(20) [not null, default: 'Pending']
  CancellationDate datetime
  CancellationReason varchar(255)
  RefundAmount decimal(10,2)
  BookingSource varchar(50) [not null, default: 'Website']
}

// 14. 預訂明細表
Table BookingDetail {
  BookingDetailID int [pk, increment]
  BookingID int [not null]
  RoomID int [not null]
  RoomTypeID int [not null]
  PricePlanID int
  DateFrom date [not null]
  DateTo date [not null]
  DailyRate decimal(10,2) [not null]
  TaxRate decimal(5,2) [not null, default: 0]
  TotalAmount decimal(10,2) [not null]
  GuestFirstName varchar(50)
  GuestLastName varchar(50)
  Status varchar(20) [not null, default: 'Confirmed']
  Notes varchar(255)
}

// 15. 付款表
Table Payment {
  PaymentID int [pk, increment]
  BookingID int [not null]
  Amount decimal(10,2) [not null]
  Currency varchar(3) [not null, default: 'TWD']
  PaymentDate datetime [not null, default: `now()`]
  PaymentMethod varchar(50) [not null]
  PaymentStatus varchar(20) [not null]
  TransactionID varchar(100)
  CardType varchar(50)
  Last4Digits varchar(4)
  Notes varchar(255)
}

// 16. 發票表
Table Invoice {
  InvoiceID int [pk, increment]
  BookingID int [not null]
  InvoiceNumber varchar(50) [not null, unique]
  InvoiceDate datetime [not null, default: `now()`]
  DueDate datetime
  Amount decimal(10,2) [not null]
  TaxAmount decimal(10,2) [not null, default: 0]
  TotalAmount decimal(10,2) [not null]
  Currency varchar(3) [not null, default: 'TWD']
  Status varchar(20) [not null, default: 'Issued']
  BillingAddress varchar(255)
  BillingName varchar(100)
  Notes varchar(255)
}

// 17. 評價表
Table Review {
  ReviewID int [pk, increment]
  BookingID int [not null]
  UserID int [not null]
  HotelID int [not null]
  Rating decimal(3,1) [not null]
  Title varchar(100)
  Content text
  ReviewDate datetime [not null, default: `now()`]
  CleanlinessRating decimal(3,1)
  ServiceRating decimal(3,1)
  LocationRating decimal(3,1)
  ValueRating decimal(3,1)
  IsVerified boolean [not null, default: false]
  IsPublished boolean [not null, default: false]
}

// 18. 員工表
Table Staff {
  StaffID int [pk, increment]
  UserID int
  HotelID int [not null]
  FirstName varchar(50) [not null]
  LastName varchar(50) [not null]
  Position varchar(50) [not null]
  Department varchar(50) [not null]
  HireDate date [not null]
  Phone varchar(20)
  Email varchar(100) [not null, unique]
  Address varchar(255)
  IsActive boolean [not null, default: true]
}

// 19. 維護記錄表
Table MaintenanceRecord {
  RecordID int [pk, increment]
  RoomID int [not null]
  ReportedByStaffID int
  ReportDate datetime [not null, default: `now()`]
  Issue varchar(255) [not null]
  Priority varchar(20) [not null, default: 'Medium']
  Status varchar(20) [not null, default: 'Reported']
  AssignedToStaffID int
  StartDate datetime
  CompletionDate datetime
  Notes text
}

// 20. 清潔記錄表
Table CleaningRecord {
  RecordID int [pk, increment]
  RoomID int [not null]
  CleanedByStaffID int [not null]
  CleaningDate datetime [not null, default: `now()`]
  Status varchar(20) [not null, default: 'Completed']
  VerifiedByStaffID int
  VerificationDate datetime
  Notes varchar(255)
}

// 關聯定義
Ref: HotelHasAmenity.HotelID > Hotel.HotelID
Ref: HotelHasAmenity.AmenityID > HotelAmenity.AmenityID
Ref: HotelImage.HotelID > Hotel.HotelID
Ref: RoomType.HotelID > Hotel.HotelID
Ref: RoomTypeHasAmenity.RoomTypeID > RoomType.RoomTypeID
Ref: RoomTypeHasAmenity.AmenityID > RoomAmenity.AmenityID
Ref: RoomTypeImage.RoomTypeID > RoomType.RoomTypeID
Ref: Room.HotelID > Hotel.HotelID
Ref: Room.RoomTypeID > RoomType.RoomTypeID
Ref: PricePlan.RoomTypeID > RoomType.RoomTypeID
Ref: Booking.UserID > User.UserID
Ref: Booking.PromotionID > Promotion.PromotionID
Ref: BookingDetail.BookingID > Booking.BookingID
Ref: BookingDetail.RoomID > Room.RoomID
Ref: BookingDetail.RoomTypeID > RoomType.RoomTypeID
Ref: BookingDetail.PricePlanID > PricePlan.PricePlanID
Ref: Payment.BookingID > Booking.BookingID
Ref: Invoice.BookingID > Booking.BookingID
Ref: Review.BookingID > Booking.BookingID
Ref: Review.UserID > User.UserID
Ref: Review.HotelID > Hotel.HotelID
Ref: Staff.UserID > User.UserID
Ref: Staff.HotelID > Hotel.HotelID
Ref: MaintenanceRecord.RoomID > Room.RoomID
Ref: MaintenanceRecord.ReportedByStaffID > Staff.StaffID
Ref: MaintenanceRecord.AssignedToStaffID > Staff.StaffID
Ref: CleaningRecord.RoomID > Room.RoomID
Ref: CleaningRecord.CleanedByStaffID > Staff.StaffID
Ref: CleaningRecord.VerifiedByStaffID > Staff.StaffID 